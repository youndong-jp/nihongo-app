<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ê²°ê³¼ - NihonGO!</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>ğŸ“ í€´ì¦ˆ ê²°ê³¼</h1>
        <p class="score">ì ìˆ˜: {{ score }} / {{ total }}</p>

        {% set vocab_list = session.get('vocab_list', []) %}
        {% set wrong_count = 0 %}

        <div class="result-list">
        {% for item in answers %}
            <div class="result-item">
                <strong class="question">{{ item.question }}</strong><br>
                <span class="your-answer {{ 'correct' if item.selected == item.correct else 'wrong' }}">
                    ë‹¹ì‹ ì˜ ë‹µ: {{ item.selected }}
                </span><br>
                <span class="correct-answer">ì •ë‹µ: {{ item.correct }} ({{ item.hiragana }})</span>
                {% if item.level %}
                    <span class="level-tag">[{{ item.level }}]</span>
                {% endif %}

                {% if item.selected != item.correct %}
                    {% set wrong_count = wrong_count + 1 %}
                    <div class="vocab-action">
                        {% if vocab_list | selectattr("question", "equalto", item.question) 
                                        | selectattr("answer", "equalto", item.correct) 
                                        | list 
                                        | length > 0 %}
                            <span class="added">âœ… ë‹¨ì–´ì¥ ì¶”ê°€ ì™„ë£Œ</span>
                        {% else %}
                            <form method="post" action="{{ url_for('add_to_vocab') }}" style="display:inline;">
                                <input type="hidden" name="question" value="{{ item.question }}">
                                <input type="hidden" name="answer" value="{{ item.correct }}">
                                <button type="submit" class="vocab-button">â• ë‹¨ì–´ì¥ì— ì¶”ê°€</button>
                            </form>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
        </div>

        {% if wrong_count > 0 %}
            <a href="{{ url_for('retry_wrong') }}">
                <button class="vocab-button" style="margin-top: 20px;">ğŸ” í‹€ë¦° ë¬¸ì œ ë‹¤ì‹œ í’€ê¸°</button>
            </a>
        {% endif %}

        <a href="{{ url_for('start') }}">
            <button class="vocab-button" style="margin-top: 20px;">ğŸš€ ì²˜ìŒë¶€í„° ë‹¤ì‹œ í’€ê¸°</button>
        </a>
    </div>
</body>
</html>
