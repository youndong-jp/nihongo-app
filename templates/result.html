{% extends "base.html" %}
{% block title %}ê²°ê³¼ - NihonGO!{% endblock %}
{% block content %}
<h1>ğŸ“ í€´ì¦ˆ ê²°ê³¼</h1>
<p>ì ìˆ˜: {{ session['score'] }} / {{ session['num_questions'] }}</p>

{% set vocab_list = session.get('vocab_list', []) %}
{% set wrong_count = 0 %}

{% for item in session['answers'] %}
    <div style="margin-bottom: 10px;">
        <strong>{{ item.question }}</strong> -
        ë‹¹ì‹ ì˜ ë‹µ:
        <span style="color: {{ 'green' if item.selected == item.correct.split()[0] else 'red' }}">
            {{ item.selected }}
        </span>
        / ì •ë‹µ: {{ item.correct }}

        {% if item.level %}
            <span style="color: gray;">({{ item.level }})</span>
        {% endif %}

        {% if item.selected != item.correct.split()[0] %}
    {% set wrong_count = wrong_count + 1 %}

    {% set already_added = vocab_list
        | selectattr('question', 'equalto', item.question)
        | selectattr('answer', 'equalto', item.correct.split()[0])
        | list | length > 0 %}

    {% if already_added %}
        <span style="color: green;">âœ… ë‹¨ì–´ì¥ ì¶”ê°€ ì™„ë£Œ</span>
    {% else %}
        <form method="post" action="{{ url_for('add_to_vocab') }}" style="display:inline;">
            <input type="hidden" name="question" value="{{ item.question }}">
            <input type="hidden" name="answer" value="{{ item.correct.split()[0] }}">
            <button type="submit">â• ë‹¨ì–´ì¥ì— ì¶”ê°€</button>
        </form>
    {% endif %}
{% endif %}


    </div>
{% endfor %}

{% if wrong_count > 0 %}
    <div style="margin-top: 30px;">
        <a href="{{ url_for('retry_wrong') }}">
            <button>ğŸ” í‹€ë¦° ë¬¸ì œ ë‹¤ì‹œ í’€ê¸°</button>
        </a>
    </div>
{% endif %}

<a href="/start">
    <button style="margin-top: 20px;">ğŸš€ ì²˜ìŒë¶€í„° ë‹¤ì‹œ í’€ê¸°</button>
</a>
{% endblock %}
